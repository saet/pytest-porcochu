ascii_art = u"""
.................................::........::..::::;X&&&$;:...:::::::....:...:........................:::...:..........:..........::.....::::...
......................:..::::..:::...:::::;&&&&&&&&&&&&&&&&&&&&x;::::..:....:..:......::....:........::....:....:..:...:.::...:........:::::....
...::.............::::..::::::......:::;X&&&&&&&&&&&&&$&&&&&&&&&&&x;:::::...:.....:::..:..:.....::::::...........:::::.:.:..:...........::..::..
.:::........:...........::........:::;x&&&&&&x+$&&&:xXXx;x;Xx$&&&&&$x:::::.::..:::::::....:....::::::....:.............:::::.::::....::::..:.:..
:................................::;+&&&&&x::+;:;+++:;;:;x;xX;xX$$&&X;::::::..:...:...:...............:....:.:...::.....::.::::::::::.::::::.:.:
:..........:..::.........:......:xxx&&&&&:+:;:$&&&$x+x$&&$xxx&&x+$&&$xx+;:::.....::...:........................::.:.....::.......:.:::.::.......
:.....:..:...............:.....::&$&&&&x;xxX$&&&xxxxX&&&&&&&&&&$x$&&$+xx+;;:....::.................:..::::..:::::::...:::::............::.....:.
......:.................:....:::x&&&&&xx;xx:;;$&&&&&&&&&&X;::;;&&+&&$::+xx+;:..:...:.:.......:...........:::.........:::::......:.....::....::::
.......:..:..................::;&&&&&;:;;X&&&&&&&&&&&&&&&&&&$Xx&&&&&$;::;xx+::.:.....:.............................:::.............:.::.....::::
::.....................:.....:;&&&&x;;x$$$&&$xxXX$$XXxxxxxx+;x+x&&&&;;::::xx;::....:::.........::.....:.....::::::::::....:::::::::...:.:::::...
::...........:.......:..:.::::+&&&x:;:XXx+;;;;;;;;:::;+xx$xxxxxxxxx;::;+x+;++;:....:.............:::::.....:::::::::.:::...::::::::::::...::....
.:.............::::::........:+&&&&;:x$x;;:::::::::::;+xX$Xxxxx;;;;;::;;;x;.;x;::..:...........::::::::::::......:::...:............::..:.....::
::.............:......:...::..:$&&&:x$x;::::::::..:::;+xx$$$Xx+;;::;;;::::;;:x+:...:..........:::.:.:::::::..:...:..:.....:.........:.::::::...:
::::::.........:...:...:.:::..:;&&&xXx;::.::::::..:::;+xx$&&Xx+;;:;x+;;:..;x:xx:...:.........:::..:..:::....::::::..:..........::.:::::::::::::.
.......:..:...::....:....::...::$&&&x;::.::::::::.:::;+xx$&$xx+;:;;x+;;;:::x:xx::........:..::...::......:................:::::...::::.......;::
...:..:..............:...::...::+&&&x+:::::::::::::;x$&&$x$$xx;:.:;;;:::::;x:x;......:..:::::::.:.........................::..:::::::.........::
.............::...:..:....::...::x&&&x:;x$&$x;::+$&&&&&&&xx$$x;:::;;;::::;x++x::::.::.....:::::::...............:.........:..:::::::::::::::::::
.............::...........::...:::&&&x;x&&&&&x;;&&&&&&:xx;;X$x::::;;;;;;;;x;xx........:::..::.......:.....................:::................;::
.............:...:.......:..::.:::&&&x;xxx:;+xx+&&&xx&&&&$x&$+::::;;;:+xx++:xx....:....:...:....:...................:....:::.:::::::::.......:::
..:..........:.......:.........:::&&&X;xX&$x;XxX&&+x&&&:$&&&$x+;;:;;;;x+;;:;x+..:.........:....:..::...:.:............::::::.:::::::::.......:::
..:.....:::::...:.........::...:::$&&&;xxx$$$X:&&&;x$&&&xx&&&&x;;;+xxx:;;::;+;.......:::::::.......::....::::......:...:::::::::::::::.......:::
....:::::::...:.........:::...::.:x&&&x:;+x$$xx&&&+X&Xx$&&&&&$x;:;+xx+xxx;;+;:::......::::..::::.............:.......:...:::::::::::::.......:.:
....::..................::...:::::;&&&&;::::::x&&&;x&$;x$&&&&$x;.;;::xxxx;;x;.::......::.........:.....::.....::::...:...:::::::::::::.........:
.:...:.................::....::..::;&&&$::.::;x&&&+x&&;;xxxXxx;::;;::xxXx;x;::::::..:::............:..::::.:..:.::::.:::::::::::::::::........::
......:................::....::..:::x&&&::.:::x&&&&&&&:+xxxx;;;:.;;;:x;;xX+:..::::::::.....................:.::..::::::::::.::::::::::.........:
....:..................::...:::....:;&&&;::.:;+&&&&&&&XXXxx;:::;::+;;;xXX+:....::...........:..:..:.......:.....:........:.:::::::::::........::
........:.............::....::.....::&&&X:..;$&&&&&;;x$&$+::::::;;+;:;&$+:::::.:...:................::::.................:.:::::::::::.......:::
..................:.........::.....::x&&&+:;&&&&&&&&+xxxx;::::::;+x;:x&X::...::::::...................::.....:::::......:..:::::::::::..........
...:.....:.:.....::.........:.......:;&&&&$&&&&&&&&&xxx;+++;;;;;xxx;:x&x:.:....................:..:...:.:.......:::.......::::::::::::.......::.
.::..:...........::........::.......::x&&&&&&&$x;x&&&&$+:;++xxxxXx;+;+&X:::..:..:.................:...:::..............:::::.:::::::::..........
.::......................:::.........:;X&&&&x$xxx;&&&;;:;::+xX$$x;xX+;X$x$X;.::..........:::..:..........:::::...:.....:::....:::::........:....
::...................................:::$&$xx&&$x;:&&$$;:;+x$$X;;xxx;:;x$&&&+.::...:.....:...............:::.:::......::............:...........
:.........................:...::..:..::;&&xxx$X;;;;&&;&+x$&$X;:xx;+xxx+X&&&&&+::.....:::.....::::::..:::::...:.:::.......::..::::..::...:....:::
:..:..........:........::::::........:.+&&x$&$x:+++&&;$&&&x:;+x;:xxX$$&&&&&&&&:.......:.......:.::.....::...:....:::.............:::..::::..:...
::............:.......:::.......::..::;x&&&&&&&x+:&&&&&&X;.:::;xxXxxx&&&x$x$&&x....:...........::...:..................:..::..:............:...:
:.........:::.........:........:::::x&&&&&&&&&&&&&&&&&&&$xX$XxxxXxxX$&&+&X;x&&&x;::.:.......::.::...:.....................::........:.....:...::
:.......::...........::.......:::::x&&&&&&&;&&&&&&&&&x$&&&&&&&&$xxx&&$;x;;x&X$&&&&&+:::..:..:::::................:.....:::::::::....:..:....:::.
:.....:::............::..:::::::::;&&&&;;;;x&&&&$X&&x:;x$&&&&&&X+;x$x;xxXxx$Xx:+x$&&&&&&$;....:..:.........:::::::.:::::::......:..:::::...:::..
:.....::....:::.:::....::::::::::;&&&&;;xx;x&&x&&&&$;::;+xxx++x+::x+;x&&X$$$x;:;;:X&&&&&&&&&&&$;.:.::...:..:::::...:::::.....:...:::..::.::::...
:.....:.....:......:::::::.:::::x&&&&:;;:.:x&&$x+&&&x::::;;;;xx+X&&x+::x&$x$x;x&&&&&&$x$&&&&&&&&&&&&&&&&x:.::....:.:...:.......::........:::....
:.:...:.....:......:::::.::::::$&&&&;:::::;+&&&$X&&&&.:::;::+x+:xx;xX&&&xxxx$&&&&&$Xx;:::::;x&&&&&&&&&&&&&&&+.....::...:......:::....::::::....:
::::................:::::::.::+&&&&:::::;$&&&&&&++&&&;::::;X$X;;x$&&&x;:;+x&&&&$+;;;;xX$&$x;::;;;;;+;:x&&&&&&&X:..:..:::....:::::.....::....::::
.::..:.....:.......:::::::::::x&&&:.:;x&&&&&&$x&&&x&&x::.;$&$x;:x&&;+xx;x$&&&&&&&&&&&&&&xx+;::::::;;;;;++;+$&&&&;.::.:::..:::...::..:.....:.:::.
.::.......:.:::::::::::::::;;x&&&&::;xxX&&&&&xx$&&x&&x.:+&&x;+xX$x;x$$x+;xx;:;;+xx$$x;:+xxx;;::.:;++;:;;;;;;;x&&&x....:.......:::::...:::..:....
..:......::::::::::::;;;+&&&&&&&&x.:;;x&&&&&&&&&&&x&&;:x&&x;x$&&$$&&&&&&&&&&&&&&&&&&&&&&x+;;:::;+xx;;:xxXx;.;+xx&&x.:.....:::::::..:..::...::::.
.::....:::::...::::;;$&&&&&&&&&&&:.::;:$&&&&&&&&&$&&&:+&&Xx$&&&&&&&&x;xxxX+::;+xX$$$Xxxxxxx+;;+xx;:x:xXx;:;;;+x+x&&;.....::....::...:.......:::.
.:.:::::..::.:::::;x&&&&&&&&;::;;:.::x&&&&&&&&&&xX&&X:X&&x&&&$$&&&$xxxX&&X;.::::..:::.::;;;;;;;;:;x+;x;;xx;::;xxxx&&+:...::....::.........::::::
..:..::::::::::;;;$&&&&&;;;::::;;:.:;$&&x&&&&Xx&&&&&&+&&$x$$xx$$x;:+$&&&x;:::::.:..::;;;;::::::;;++:xx;++::::;+xx+x&&+:...:...:::.......:....::.
.....:....::::::x&&&&&;:;:x+::.;;:.:x&&&&&&&&Xx&&&&&;$&&$xxxxxx+:::::x&&X..:::..:::::::::.::::::;;;:x+:;::::::;;+x;+&$;::::.......:::::::..:::..
...:::...:::::;$&&&&&:+:;;;x;::;;:.;X&&&&&&&&+$&&;$&&&&&xxxxxx+:::.:;&&&+::.:::::::::::::::::::.:;:+$x+;::::xX;:+x+:x&x::::..::....::::...::::::
...::..::::::;X&&&&x:;+:;+:;+;;;:.:+$&&&&&&&&:&&&;:$&&&$xxxxx+;:.::;&&&x:::::::::.:::::::::..::;+x;$&xX;:;X&$;x;;xx;:x$;:;;;::.:..::::::::::::::
...::..::::::x&&&&;;:;+:;x+.;+x;..:+$&x$&;&&&:&&&:+&&&&x;+x;::.:::;&&&$:...:::..:...::::::;;++xxxX;&&x&+x&&+X&x:;xXx;+xx..::::::::::::::::::::::
.:...:::::.:+&&&&;:::;x+:;x;;xx:.::+$&x&&&&&&x&&&&&&&&$x++;::...;x&&&$;......:..:.::::;;;+xxxx++;&+&&+&&&;x&&+::;+X$+:;&X:::::::::::::::::::::::
.....::.:::;$&&&;:::::+x+::;xx;:::;;X&&&&&&&$x&&&&&&&$Xx+;;:::.;&&&&&;:..:...:::::::::::;;;xX$X;:&x&&x&&x&&X:::::;x$X;.&x:::::::::::::::::::::::
.:..:::.:::+&&&x:;:::::;x+:;;;+x$$X&&$&&&xx;:+&&&&&$xxxx;:::::.x&&&$+:...:.:::::::::::::;;xXXx$$x&x&&&;$&&;::::.:;x$x;:$&:::::::::::::::::::::::
.::.:::::::x&&&;:;;::::::;+;;+$&&$$&$x&&&&&&x+&&++;::+xXx+;;:::$&&:::::::::::..:::::::::;xxx+::x&&xX&&xX&&::::.::;X$+;;;x&::::::::::::::::::::::
::..::::::;$&&&;:.;;;::;;xx+;x&$:;;xx&&&&&&&&&&&::::x$&&&Xx+;;;$&&:;+x$&&&&$+:::::::::;+x$x+;:::X&&+&&Xx&&::::.:.;xXxXx;;:$:::::::::::::::::::::
:..::::::;+&&&x:;;;::.:;xxx;+XX;x;x;&$&&&$&&&&&+:;+x&&&&&X+;+x$&&&&&&&&&&&&&&;:::::::;;x$Xxx;:.:;x&$x&&x&&:::::::;xXx;;;;;x:::::::::::::::::::::
..::.::::;$&&&:::;;;:.;xx+;;+x+;:xxx$&&&xx;X&$;;X&&&&&$&&$X&&&&&&&&&&$x+;:;&&$+;::::;;;xxx::::::;+X&;&&&&$:::;::::;++xx+;;:&::::::::::::::::::::
..::.::::;&&&;...::.:;xx;::;;;;:x$+X&&$x;;++;;$&&&&&&$X&&&&&&&&&&&x::;;;;::x&&&$x+;::;;xx+;::::.::+&$+&&&x:::::::::;xX;:::;&::::::::::::::::::::
:..:::::;+&&&:.::::;x$x;::;;;;;X&x:;xx++++;.x&&&&$xxxxX&&&&&&X;::..:;+;+x;;:;X&&&&$x;;;;xx+;:::;;;.X&+xx+::::::.::;+$$+::;;&x:::::::::::::::::::
:..:::::;X&&$.::::;xXx:::;;;;+X&x:.;+++++;:x&&$+;;;xxx;+x++;xx+::..::xx;xxx;:;+xx$&&&Xx;xxx+:::::;;;&&;:::::::::;;:;$$x:..:x&:::::::::::::::::::
:..:::::;&&&::::;+xx;::::;;;+X&X::.;x++;;:X&&$;::;x&Xx:;;:xx:xx+;::.:;xX;+XX+:;;;;;x$&$xxxxx+:.:::::x&X::::::::::::;x$x;::;;X&&:::::::::::::::::
.:.:::.:+&&&.:;;xxx;:::::;;+x&$::::;xx;::X&&$;:;x$&$+x;;;;+Xx:;xx;::::+X$x+$&x:;+;+xxxx++++x+;:::::::&&;::.::::::::;xxxx;;;;++X:::::::::::::::::
.:::::::x&&&.:;xx+::::::;;xX&$;;:::;xx;.x&&$+;x$&&$+;+;:+;;xxx:;xx;::.:+X&&;$&&+:xxxxxx;;:;;+;::;;;;:x&$::::::::::.:;xXX+;;;;x:+x;;::::::.::::::
.:::::;X&&&&:;xx;.:::..:;xX&&x:;:::x$x:+&&&xx$&&Xx;:;;+;xx:;xxx:;++;;:::;x&&xx&&$x;xXx;:::;++;::::::;;&&x:::.:::::::;x$$x;::;;+:Xx::::.::::..:::
:::::;&&&&&:+Xx;::::.::;xx$&x:;;:::X$;;$&&$$&$xx;::::;++;x;:;;xx:;++;;;:.;X&&$:$&&$xxxx;:::;+;.:::::++x&&;.::..:::::;x$$xxx+:;xxx&x......::.::::
:::;+&&&&&:xXx:::::..:;;x$$x:;;:::x&x:x&&&&$x;;;::::::;+x;;:::;xx::;;;;;;::x&&&:+X$Xx+;;;;+x+;:::::;++:&&$::::.:::::x$&&&&&&&&&x+$$;....:::::..:
................................................................................................................................................
"""


def pytest_sessionfinish(session, exitstatus):
    """Attach the exit status to the session config so we can read it later.

    We need this in order to tell whether the test run passed or not.
    """
    setattr(session.config, "exitstatus", exitstatus)


def pytest_unconfigure(config):
    """Show the surprised porcochu if enabled when all tests pass."""
    # Print nothing if the plugin is not enabled
    if not config.option.porcochu:
        return

    # Print nothing if the pytest_sessionfinish hook was not called
    if not hasattr(config, "exitstatus"):
        return

    # Print nothing if the tests failed
    if getattr(config, "exitstatus") != 0:
        return

    tw = config.get_terminal_writer()
    tw.write(ascii_art, green=True)


def pytest_addoption(parser):
    """Add a CLI flag to enable showing surprise."""
    group = parser.getgroup("porcochu")
    group.addoption(
        "--porcochu",
        action="store_true",
        default=False,
        help="Add a surprised Pikachu to successful test result log.",
    )
